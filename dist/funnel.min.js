DevExpress.JS.Localization.addCultureInfo({messages:{"DashboardWebCustomItemStringId.ToolBoxCustomItemCaption":"Custom Items","DashboardWebCustomItemStringId.DefaultNameFunnelD3":"Funnel D3","DashboardWebCustomItemStringId.Values":"Values","DashboardWebCustomItemStringId.SetValue":"Set Value","DashboardWebCustomItemStringId.ConfigureValue":"Configure Value","DashboardWebCustomItemStringId.Arguments":"Arguments","DashboardWebCustomItemStringId.SetArgument":"Set Argument","DashboardWebCustomItemStringId.ConfigureArgument":"Configure Argument","DashboardWebCustomItemStringId.IsCurved":"Curved","DashboardWebCustomItemStringId.IsDynamicHeight":"Dynamic Height","DashboardWebCustomItemStringId.PinchCount":"Pinch Count","DashboardWebCustomItemStringId.FillType":"Fill Type","DashboardWebCustomItemStringId.FillTypeSolid":"Solid","DashboardWebCustomItemStringId.FillTypeGradient":"Gradient","DashboardWebCustomItemStringId.SectionName":"Settings"}()});var FUNNEL_D3_EXTENSION_NAME="FunnelD3";DevExpress.JS.Dashboard.itemTypesMap[FUNNEL_D3_EXTENSION_NAME]={type:DevExpress.JS.Dashboard.CustomItem,customItemType:FUNNEL_D3_EXTENSION_NAME,bindings:[{propertyName:"Values",dataItemType:"Measure",array:!0,slice:"data",displayName:"DashboardWebCustomItemStringId.Values",placeholder:"DashboardWebCustomItemStringId.SetValue",configurePlaceholder:"DashboardWebCustomItemStringId.ConfigureValue"},{propertyName:"Arguments",dataItemType:"Dimension",array:!0,slice:"data",interactivityEnabled:!0,coloringEnabled:!0,displayName:"DashboardWebCustomItemStringId.Arguments",placeholder:"DashboardWebCustomItemStringId.SetArgument",configurePlaceholder:"DashboardWebCustomItemStringId.ConfigureArgument"}],properties:[{propertyName:"FillType",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.buttonGroup,displayName:"DashboardWebCustomItemStringId.FillType",sectionName:"DashboardWebCustomItemStringId.SectionName",values:{Solid:"DashboardWebCustomItemStringId.FillTypeSolid",Gradient:"DashboardWebCustomItemStringId.FillTypeGradient"},defaultVal:"Solid"},{propertyName:"IsCurved",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.boolYesNo,displayName:"DashboardWebCustomItemStringId.IsCurved",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:!1},{propertyName:"IsDynamicHeight",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.boolYesNo,displayName:"DashboardWebCustomItemStringId.IsDynamicHeight",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:!0},{propertyName:"PinchCount",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.numeric,editorOptions:{min:0},displayName:"DashboardWebCustomItemStringId.PinchCount",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:0}],interactivity:{filter:!0,drillDown:!0},icon:FUNNEL_D3_EXTENSION_NAME,groupName:"custom",groupTitle:"DashboardWebCustomItemStringId.ToolBoxCustomItemCaption",title:"DashboardWebCustomItemStringId.DefaultNameFunnelD3",index:3};var FUNNEL_D3_ICON='<?xml version="1.0" encoding="utf-8"?>\n    <svg version="1.1" id="'+FUNNEL_D3_EXTENSION_NAME+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t            viewBox="4 -4 24 24" style="enable-background:new 4 -4 24 24;" xml:space="preserve">\n        <style type="text/css">\n\t        .dx_violet{fill:#8080C0;}\n\t        .dx_gray{fill:#7B7B7B;}\n\t        .dx_darkgray{fill:#414141;}\n        </style>\n        <path class="dx_darkgray" d="M24.9-2h-9.8C14.5-2,14-1.5,14-0.9V4h5v6h5.9c0.6,0,1.1-0.5,1.1-1.1v-9.8C26-1.5,25.5-2,24.9-2z"/>\n        <path class="dx_gray" d="M20.9,2h-9.8C10.5,2,10,2.5,10,3.1V8h6v6h4.9c0.6,0,1.1-0.5,1.1-1.1V3.1C22,2.5,21.5,2,20.9,2z"/>\n        <path class="dx_violet" d="M16.9,18H7.1C6.5,18,6,17.5,6,16.9V7.1C6,6.5,6.5,6,7.1,6h9.8C17.5,6,18,6.5,18,7.1v9.8\n\t        C18,17.5,17.5,18,16.9,18z"/>\n    </svg>',funnelD3Item=function(e){function t(t,n,i){e.call(this,n,i),this.item=t,this.funnelSettings=void 0,this.funnelViewer=null,this.selectionValues=[],this._subscribeProperties()}return __extends(t,e),t.prototype.setSize=function(t,n){e.prototype.setSize.call(this,t,n),this._update({options:{chart:{width:this.contentWidth(),height:this.contentHeight()}}})},t.prototype.renderContent=function(e,t){var n=this._getDataSource(),i=this._getFunnelId();this._ensureFunnelLibrary(e)&&n&&(t||(e.empty(),e.append($("<div/>").attr("id",i)),this.funnelViewer=new D3Funnel("#"+i)),this._update({data:n},!1))},t.prototype.clearSelection=function(){e.prototype.clearSelection.call(this),this._update({data:this._getDataSource()},!1)},t.prototype._getDataSource=function(){var e=this,t=[];return this.item.iterateData(function(n){var i=n.getValue("Values");e._hasArguments()?t.push([{data:n,property:"Arguments"}].concat(i)):t=i.map(function(t,n){return[e.item.Values()[n].dataItem().displayName(),t]})},"data"),t.length>0&&t[0].length>1?t:void 0},t.prototype._ensureFunnelLibrary=function(e){return!!window.D3Funnel||(e.empty(),e.append($("<div/>",{css:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"95%",color:"#CF0F2E","text-align":"center"}}).html("'D3Funnel' cannot be displayed. You should include 'd3.v3.min.js' and 'd3-funnel.js' libraries.")),!1)},t.prototype._ensureFunnelSettings=function(){var e=this,t=function(t){return e.funnelViewer.colorizer.shade(t,-.5)};return this.funnelSettings||(this.funnelSettings={data:void 0,options:{chart:{bottomPinch:this.item.PinchCount(),curve:{enabled:this.item.IsCurved()}},block:{dynamicHeight:this.item.IsDynamicHeight(),highlight:ko.computed(function(){return e.item.isFilterAllowed()&&e.item.isMasterFilter()||e.item.isDrillDownAllowed()&&e.item.isDrillDownEnabled()}),fill:{scale:function(n){var i=e.funnelSettings.data[n][0];if(!i||!i.data)return"#5F8195";var a=i.data.getColor(i.property);return e.item.isSelected(i.data)?t(a):a},type:this.item.FillType().toLowerCase()}},label:{format:function(e,t){if(!e.data)return e;var n=e.data.getDisplayText(e.property);return(Array.isArray(n)?n.join(" - "):n)+": "+t}},events:{click:{block:function(t){return e._onClick(t)}}}}}),this.funnelSettings},t.prototype._getFunnelId=function(){return"dx-d3-funnel-"+this.item.componentName()},t.prototype._onClick=function(e){if(this._hasArguments()&&e.label){var t=e.label.raw.data;this.item.isMasterFilter()&&!this.item.isSelected(t)?(this.item.setMasterFilter(this,t),this._update()):this.item.isDrillDownEnabled()&&this.item.drillDown(this,t)}},t.prototype._subscribeProperties=function(){var e=this;this.item.IsCurved.subscribe(function(t){return e._update({options:{chart:{curve:{enabled:t}}}})}),this.item.IsDynamicHeight.subscribe(function(t){return e._update({options:{block:{dynamicHeight:t}}})}),this.item.PinchCount.subscribe(function(t){return e._update({options:{chart:{bottomPinch:t}}})}),this.item.FillType.subscribe(function(t){return e._update({options:{block:{fill:{type:t.toLowerCase()}}}})})},t.prototype._update=function(e,t){void 0===e&&(e={}),void 0===t&&(t=!0),this.funnelViewer&&(this._ensureFunnelSettings(),t?$.extend(!0,this.funnelSettings,e):$.extend(this.funnelSettings,e),this.funnelViewer.draw(this.funnelSettings.data,this.funnelSettings.options))},t.prototype._hasArguments=function(){return this.item.Arguments().length>0},t.prototype.getInfo=function(){var t=$("#"+this._getFunnelId()).children()[0];return $.extend(!0,e.prototype.getInfo.call(this),{customItemExportInfo:{image:this._getImageBase64(t,this.contentWidth(),this.contentHeight())}})},t.prototype._getImageBase64=function(e,t,n){var i=$("<canvas>")[0],a=(new XMLSerializer).serializeToString(e),r="data:image/svg+xml;base64,"+window.btoa(a),s=new Image;return s.src=r,i.width=t,i.height=n,i.getContext("2d").drawImage(s,0,0),i.toDataURL().replace("data:image/png;base64,","")},t}(DevExpress.dashboard.viewerItems.customItem),funnelD3ItemExtension=function(e){return e.registerIcon(FUNNEL_D3_ICON),{name:"dxdde-funnel-d3",createViewerItem:function(e,t,n,i){e.customItemType&&e.customItemType()===FUNNEL_D3_EXTENSION_NAME&&(i.viewerItem=new funnelD3Item(e,t,n))}}};