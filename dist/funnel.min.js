DevExpress.Localization.addCultureInfo({messages:{"DashboardWebCustomItemStringId.DefaultNameFunnelD3":"Funnel D3","DashboardWebCustomItemStringId.Values":"Values","DashboardWebCustomItemStringId.SetValue":"Set Value","DashboardWebCustomItemStringId.ConfigureValue":"Configure Value","DashboardWebCustomItemStringId.Arguments":"Arguments","DashboardWebCustomItemStringId.SetArgument":"Set Argument","DashboardWebCustomItemStringId.ConfigureArgument":"Configure Argument","DashboardWebCustomItemStringId.IsCurved":"Curved","DashboardWebCustomItemStringId.IsDynamicHeight":"Dynamic Height","DashboardWebCustomItemStringId.PinchCount":"Pinch Count","DashboardWebCustomItemStringId.FillType":"Fill Type","DashboardWebCustomItemStringId.FillTypeSolid":"Solid","DashboardWebCustomItemStringId.FillTypeGradient":"Gradient","DashboardWebCustomItemStringId.SectionName":"Settings"}});var FUNNEL_D3_EXTENSION_NAME="FunnelD3",funnelMeta={bindings:[{propertyName:"Values",dataItemType:"Measure",array:!0,enableColoring:!0,displayName:"DashboardWebCustomItemStringId.Values",emptyPlaceholder:"DashboardWebCustomItemStringId.SetValue",selectedPlaceholder:"DashboardWebCustomItemStringId.ConfigureValue"},{propertyName:"Arguments",dataItemType:"Dimension",array:!0,enableInteractivity:!0,enableColoring:!0,displayName:"DashboardWebCustomItemStringId.Arguments",emptyPlaceholder:"DashboardWebCustomItemStringId.SetArgument",selectedPlaceholder:"DashboardWebCustomItemStringId.ConfigureArgument"}],properties:[{propertyName:"FillType",editor:DevExpress.Dashboard.Metadata.editorTemplates.buttonGroup,displayName:"DashboardWebCustomItemStringId.FillType",sectionName:"DashboardWebCustomItemStringId.SectionName",values:{Solid:"DashboardWebCustomItemStringId.FillTypeSolid",Gradient:"DashboardWebCustomItemStringId.FillTypeGradient"},defaultVal:"Solid"},{propertyName:"IsCurved",editor:DevExpress.Dashboard.Metadata.editorTemplates.boolYesNo,displayName:"DashboardWebCustomItemStringId.IsCurved",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:!1,from:DevExpress.Dashboard.Metadata.parseBool},{propertyName:"IsDynamicHeight",editor:DevExpress.Dashboard.Metadata.editorTemplates.boolYesNo,displayName:"DashboardWebCustomItemStringId.IsDynamicHeight",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:!0,from:DevExpress.Dashboard.Metadata.parseBool},{propertyName:"PinchCount",editor:DevExpress.Dashboard.Metadata.editorTemplates.numeric,editorOptions:{min:0},displayName:"DashboardWebCustomItemStringId.PinchCount",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:0}],interactivity:{filter:!0,drillDown:!0},icon:FUNNEL_D3_EXTENSION_NAME,title:"DashboardWebCustomItemStringId.DefaultNameFunnelD3",index:3},FUNNEL_D3_ICON='<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 21.0.2, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="'+funnelMeta.icon+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve"><polygon class="dx_green" points="2,1 22,1 16,8 8,8 "/><polygon class="dx_blue" points="8,9 16,9 14,15 10,15 "/><polygon class="dx_red" points="10,16 14,16 13,23 11,23 "/></svg>',funnelD3Item=function(e){function t(t,n,i){e.call(this,t,n,i),this.funnelSettings=void 0,this.funnelViewer=null,this.selectionValues=[],this.exportingImage=new Image,this._subscribeProperties()}return __extends(t,e),t.prototype.renderContent=function(e,t){var n=this._getDataSource();this._ensureFunnelLibrary(e)&&(n?(t&&this.funnelViewer||(this.$funnelContainer&&this.$funnelContainer.remove(),e.empty(),this.$funnelContainer=$("<div/>",{style:"margin:20px;height:calc(100% - 40px);"}),e.append(this.$funnelContainer),this.funnelViewer=new D3Funnel(this.$funnelContainer[0])),this._update(n,this._getFunnelSizeOptions())):(e.empty(),this.funnelViewer=null))},t.prototype.setSize=function(t,n){e.prototype.setSize.call(this,t,n),this._update(null,this._getFunnelSizeOptions())},t.prototype.clearSelection=function(){e.prototype.clearSelection.call(this),this._update(this._getDataSource())},t.prototype.allowExportSingleItem=function(){return!this._isIEBrowser()},t.prototype.getExportInfo=function(){if(!this._isIEBrowser())return{image:this._getImageBase64()}},t.prototype._getFunnelSizeOptions=function(){return{chart:{width:this.$funnelContainer.innerWidth(),height:this.$funnelContainer.innerHeight()}}},t.prototype._getDataSource=function(){var e=this,t=this.getBindingValue("Values");if(0!=t.length){var n=[];return this.iterateData(function(i){var r=i.getValue("Values"),a=i.getDisplayText("Values"),o=i.getColor("Values");if(e._hasArguments()){var s=i.getDisplayText("Arguments").join(" - ")+": "+a;n.push([{data:i,text:s,color:o[0]}].concat(r))}else n=r.map(function(e,n){return[{text:t[n].displayName()+": "+a[n],color:o[n]},e]})}),n.length>0?n:void 0}},t.prototype._ensureFunnelLibrary=function(e){return!!window.D3Funnel||(e.empty(),e.append($("<div/>",{css:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"95%",color:"#CF0F2E","text-align":"center"}}).html("'D3Funnel' cannot be displayed. You should include 'd3.v3.min.js' and 'd3-funnel.js' libraries.")),!1)},t.prototype._ensureFunnelSettings=function(){var e=this,t=function(t){return e.funnelViewer.colorizer.shade(t,-.5)};return this.funnelSettings||(this.funnelSettings={data:void 0,options:{chart:{bottomPinch:this.getPropertyValue("PinchCount"),curve:{enabled:this.getPropertyValue("IsCurved")}},block:{dynamicHeight:this.getPropertyValue("IsDynamicHeight"),fill:{scale:function(n){var i=e.funnelSettings.data[n][0];return i.data&&e.isSelected(i.data)?t(i.color):i.color},type:this.getPropertyValue("FillType").toLowerCase()}},label:{format:function(e,t){return e.text}},events:{click:{block:function(t){return e._onClick(t)}}}}}),this.funnelSettings.options.block.highlight=this.canDrillDown()||this.canMasterFilter(),this.funnelSettings},t.prototype._onClick=function(e){if(this._hasArguments()&&e.label){var t=e.label.raw.data;this.canDrillDown(t)?this.drillDown(t):this.canMasterFilter(t)&&(this.setMasterFilter(t),this._update())}},t.prototype._subscribeProperties=function(){var e=this;this.subscribe("IsCurved",function(t){return e._update(null,{chart:{curve:{enabled:t}}})}),this.subscribe("IsDynamicHeight",function(t){return e._update(null,{block:{dynamicHeight:t}})}),this.subscribe("PinchCount",function(t){return e._update(null,{chart:{bottomPinch:t}})}),this.subscribe("FillType",function(t){return e._update(null,{block:{fill:{type:t.toLowerCase()}}})})},t.prototype._update=function(e,t){this._ensureFunnelSettings(),e&&(this.funnelSettings.data=e),t&&$.extend(!0,this.funnelSettings.options,t),this.funnelViewer&&(this.funnelViewer.draw(this.funnelSettings.data,this.funnelSettings.options),this._updateExportingImage())},t.prototype._updateExportingImage=function(){var e=this.$funnelContainer.children()[0],t=(new XMLSerializer).serializeToString(e),n="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(t)));this.exportingImage.src=n},t.prototype._hasArguments=function(){return this.getBindingValue("Arguments").length>0},t.prototype._getImageBase64=function(){var e=$("<canvas>")[0];return e.width=this.$funnelContainer.innerWidth(),e.height=this.$funnelContainer.innerHeight(),e.getContext("2d").drawImage(this.exportingImage,0,0),e.toDataURL().replace("data:image/png;base64,","")},t.prototype._isIEBrowser=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0},t}(DevExpress.Dashboard.customViewerItem),funnelD3ItemExtension=function(e){return e.registerIcon(FUNNEL_D3_ICON),{name:FUNNEL_D3_EXTENSION_NAME,metaData:funnelMeta,createViewerItem:function(e,t,n){return new funnelD3Item(e,t,n)}}};