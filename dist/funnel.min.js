DevExpress.JS.Localization.addCultureInfo({messages:{"DashboardWebCustomItemStringId.ToolBoxCustomItemCaption":"Custom Items","DashboardWebCustomItemStringId.DefaultNameFunnelD3":"Funnel D3","DashboardWebCustomItemStringId.Values":"Values","DashboardWebCustomItemStringId.SetValue":"Set Value","DashboardWebCustomItemStringId.ConfigureValue":"Configure Value","DashboardWebCustomItemStringId.Arguments":"Arguments","DashboardWebCustomItemStringId.SetArgument":"Set Argument","DashboardWebCustomItemStringId.ConfigureArgument":"Configure Argument","DashboardWebCustomItemStringId.IsCurved":"Curved","DashboardWebCustomItemStringId.IsDynamicHeight":"Dynamic Height","DashboardWebCustomItemStringId.PinchCount":"Pinch Count","DashboardWebCustomItemStringId.FillType":"Fill Type","DashboardWebCustomItemStringId.FillTypeSolid":"Solid","DashboardWebCustomItemStringId.FillTypeGradient":"Gradient","DashboardWebCustomItemStringId.SectionName":"Settings"}});var FUNNEL_D3_EXTENSION_NAME="FunnelD3",funnelMeta={bindings:[{propertyName:"Values",dataItemType:"Measure",array:!0,displayName:"DashboardWebCustomItemStringId.Values",placeholder:"DashboardWebCustomItemStringId.SetValue",configurePlaceholder:"DashboardWebCustomItemStringId.ConfigureValue"},{propertyName:"Arguments",dataItemType:"Dimension",array:!0,interactivityEnabled:!0,coloringEnabled:!0,displayName:"DashboardWebCustomItemStringId.Arguments",placeholder:"DashboardWebCustomItemStringId.SetArgument",configurePlaceholder:"DashboardWebCustomItemStringId.ConfigureArgument"}],properties:[{propertyName:"FillType",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.buttonGroup,displayName:"DashboardWebCustomItemStringId.FillType",sectionName:"DashboardWebCustomItemStringId.SectionName",values:{Solid:"DashboardWebCustomItemStringId.FillTypeSolid",Gradient:"DashboardWebCustomItemStringId.FillTypeGradient"},defaultVal:"Solid"},{propertyName:"IsCurved",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.boolYesNo,displayName:"DashboardWebCustomItemStringId.IsCurved",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:!1},{propertyName:"IsDynamicHeight",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.boolYesNo,displayName:"DashboardWebCustomItemStringId.IsDynamicHeight",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:!0},{propertyName:"PinchCount",editor:DevExpress.JS.Dashboard.Metadata.editorTemplates.numeric,editorOptions:{min:0},displayName:"DashboardWebCustomItemStringId.PinchCount",sectionName:"DashboardWebCustomItemStringId.SectionName",defaultVal:0}],interactivity:{filter:!0,drillDown:!0},icon:FUNNEL_D3_EXTENSION_NAME,groupName:"custom",groupTitle:"DashboardWebCustomItemStringId.ToolBoxCustomItemCaption",title:"DashboardWebCustomItemStringId.DefaultNameFunnelD3",index:3},FUNNEL_D3_ICON='<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="'+funnelMeta.icon+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t            viewBox="4 -4 24 24" style="enable-background:new 4 -4 24 24;" xml:space="preserve">        <style type="text/css">\t        .dx_ruby{fill:#FA7864;}        </style>        <polygon class="dx_ruby" points="4,-2 14,12 14,17 18,17 18,12 28,-2" />    </svg>',funnelD3Item=function(e){function t(t,n,i){e.call(this,t,n,i),this.funnelSettings=void 0,this.funnelViewer=null,this.selectionValues=[],this._subscribeProperties()}return __extends(t,e),t.prototype.setSize=function(t,n){e.prototype.setSize.call(this,t,n),this._update({options:{chart:{width:this.contentWidth(),height:this.contentHeight()}}})},t.prototype.renderContent=function(e,t){var n=this._getDataSource(),i=this._getFunnelId();this._ensureFunnelLibrary(e)&&(n?(t&&this.funnelViewer||(e.empty(),e.append($("<div/>").attr("id",i)),this.funnelViewer=new D3Funnel("#"+i)),this._update({data:n},!1)):(e.empty(),this.funnelViewer=null))},t.prototype.clearSelection=function(){e.prototype.clearSelection.call(this),this._update({data:this._getDataSource()},!1)},t.prototype.allowExportSingleItem=function(){return!0},t.prototype.getExportInfo=function(){var e=$("#"+this._getFunnelId()).children()[0];return{image:this._getImageBase64(e,this.contentWidth(),this.contentHeight())}},t.prototype._getDataSource=function(){var e=this,t=this.getBindingValue("Values");if(0!=t.length){var n=[];return this.model.iterateData(function(i){var r=i.getValue("Values"),o=i.getDisplayText("Values");if(e._hasArguments()){var a=i.getDisplayText("Arguments").join(" - ")+": "+o,s=i.getColor("Arguments");n.push([{data:i,text:a,color:s}].concat(r))}else n=r.map(function(e,n){return[{text:t[n].displayName()+": "+o[n],color:"#5F8195"},e]})}),n.length>0?n:void 0}},t.prototype._ensureFunnelLibrary=function(e){return!!window.D3Funnel||(e.empty(),e.append($("<div/>",{css:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"95%",color:"#CF0F2E","text-align":"center"}}).html("'D3Funnel' cannot be displayed. You should include 'd3.v3.min.js' and 'd3-funnel.js' libraries.")),!1)},t.prototype._ensureFunnelSettings=function(){var e=this,t=function(t){return e.funnelViewer.colorizer.shade(t,-.5)};return this.funnelSettings||(this.funnelSettings={data:void 0,options:{chart:{bottomPinch:this.getPropertyValue("PinchCount"),curve:{enabled:this.getPropertyValue("IsCurved")}},block:{dynamicHeight:this.getPropertyValue("IsDynamicHeight"),fill:{scale:function(n){var i=e.funnelSettings.data[n][0];return i.data&&e.isSelected(i.data)?t(i.color):i.color},type:this.getPropertyValue("FillType").toLowerCase()}},label:{format:function(e,t){return e.text}},events:{click:{block:function(t){return e._onClick(t)}}}}}),this.funnelSettings.options.block.highlight=this.model.isMasterFilter()||this.model.isDrillDownEnabled(),this.funnelSettings},t.prototype._getFunnelId=function(){return"dx-d3-funnel-"+this.model.componentName()},t.prototype._onClick=function(e){if(this._hasArguments()&&e.label){var t=e.label.raw.data;this.model.isMasterFilter()&&!this.isSelected(t)?(this.setMasterFilter(t),this._update()):this.model.isDrillDownEnabled()&&this.drillDown(t)}},t.prototype._subscribeProperties=function(){var e=this;this.subscribeProperty("IsCurved",function(t){return e._update({options:{chart:{curve:{enabled:t}}}})}),this.subscribeProperty("IsDynamicHeight",function(t){return e._update({options:{block:{dynamicHeight:t}}})}),this.subscribeProperty("PinchCount",function(t){return e._update({options:{chart:{bottomPinch:t}}})}),this.subscribeProperty("FillType",function(t){return e._update({options:{block:{fill:{type:t.toLowerCase()}}}})})},t.prototype._update=function(e,t){e||(e={}),t||(t=!0),this._ensureFunnelSettings(),t?$.extend(!0,this.funnelSettings,e):$.extend(this.funnelSettings,e),this.funnelViewer&&this.funnelViewer.draw(this.funnelSettings.data,this.funnelSettings.options)},t.prototype._hasArguments=function(){return this.getBindingValue("Arguments").length>0},t.prototype._getImageBase64=function(e,t,n){var i=$("<canvas>")[0],r=(new XMLSerializer).serializeToString(e),o="data:image/svg+xml;base64,"+window.btoa(r),a=new Image;return a.src=o,i.width=t,i.height=n,i.getContext("2d").drawImage(a,0,0),i.toDataURL().replace("data:image/png;base64,","")},t}(DevExpress.JS.Dashboard.customViewerItem),funnelD3ItemExtension=function(e){return e.registerIcon(FUNNEL_D3_ICON),{name:FUNNEL_D3_EXTENSION_NAME,metaData:funnelMeta,createViewerItem:function(e,t,n,i){e.customItemType()===FUNNEL_D3_EXTENSION_NAME&&(i.viewerItem=new funnelD3Item(e,t,n))}}};